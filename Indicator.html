<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Unified Paddy Irrigation AI System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body class="bg-gray-100">
  <header class="bg-green-800 text-white p-6 shadow-lg">
    <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold">ðŸŒ¾ Smart Paddy Irrigation AI</h1>
        <p class="text-sm opacity-90">Precision + Prediction + Real-Time + User Input</p>
      </div>
      <div class="mt-4 md:mt-0 flex items-center space-x-2">
        <span id="currentDateTime" class="text-sm bg-green-700 px-3 py-1 rounded"></span>
        <span id="connectionStatus" class="text-sm bg-blue-600 px-3 py-1 rounded flex items-center">
          <i class="fas fa-circle-notch fa-spin mr-1"></i> Connecting...
        </span>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- User Input Section -->
    <section class="bg-white p-5 rounded-lg shadow-md lg:col-span-1">
      <h2 class="text-xl font-semibold mb-4 flex items-center">
        <i class="fas fa-tractor mr-2 text-green-600"></i> Field & Soil Data
      </h2>
      <form id="irrigationForm" class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">Nitrogen (ppm):</label>
            <input type="number" id="inputN" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500" required value="42" min="0" max="200" />
            <div class="text-xs text-gray-500 mt-1">Optimal: 35-60 ppm</div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Phosphorus (ppm):</label>
            <input type="number" id="inputP" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500" required value="18" min="0" max="100" />
            <div class="text-xs text-gray-500 mt-1">Optimal: 20-40 ppm</div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Potassium (ppm):</label>
            <input type="number" id="inputK" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500" required value="120" min="0" max="300" />
            <div class="text-xs text-gray-500 mt-1">Optimal: 100-200 ppm</div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Zinc (ppm):</label>
            <input type="number" step="0.1" id="inputZn" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500" required value="0.8" min="0" max="5" />
            <div class="text-xs text-gray-500 mt-1">Optimal: 1.5-3.0 ppm</div>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700">Soil Moisture (%):</label>
          <input type="range" id="inputMoisture" min="0" max="100" value="65" class="w-full mt-2" />
          <div class="flex justify-between text-xs text-gray-500">
            <span>0%</span>
            <span id="moistureValue">65%</span>
            <span>100%</span>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700">Water Source:</label>
          <select id="inputWater" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500">
            <option value="canal">Canal</option>
            <option value="well">Well</option>
            <option value="rainfed">Rainfed</option>
            <option value="tank">Tank</option>
            <option value="river">River</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700">Field Area (acres):</label>
          <input type="number" id="inputArea" class="w-full p-2 border rounded focus:ring-2 focus:ring-green-500" value="5" min="0.1" step="0.1" />
        </div>
        
        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center justify-center">
          <i class="fas fa-brain mr-2"></i> Analyze with AI
        </button>
      </form>
    </section>

    <!-- Output Section -->
    <section class="bg-white p-5 rounded-lg shadow-md lg:col-span-2">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold flex items-center">
          <i class="fas fa-chart-line mr-2 text-green-600"></i> AI Irrigation Analysis
        </h2>
        <div class="flex space-x-2">
          <button id="saveBtn" class="bg-blue-100 text-blue-600 px-3 py-1 rounded text-sm hover:bg-blue-200">
            <i class="fas fa-save mr-1"></i> Save
          </button>
          <button id="historyBtn" class="bg-gray-100 text-gray-600 px-3 py-1 rounded text-sm hover:bg-gray-200">
            <i class="fas fa-history mr-1"></i> History
          </button>
        </div>
      </div>
      
      <div id="resultOutput" class="space-y-4 mb-6">
        <div class="text-center py-10 text-gray-400">
          <i class="fas fa-leaf fa-3x mb-3"></i>
          <p>Enter your field data and click "Analyze with AI" to get recommendations</p>
        </div>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="bg-gray-50 p-4 rounded-lg border">
          <h3 class="font-medium mb-2 text-gray-700 flex items-center">
            <i class="fas fa-tint mr-2 text-blue-500"></i> Water Requirements
          </h3>
          <div id="waterChartContainer" class="h-40">
            <canvas id="waterChart"></canvas>
          </div>
          <p class="mt-2 text-sm">Predicted Water Need: <span id="predictedWater">N/A</span> L</p>
        </div>
        <div class="bg-gray-50 p-4 rounded-lg border">
          <h3 class="font-medium mb-2 text-gray-700 flex items-center">
            <i class="fas fa-flask mr-2 text-purple-500"></i> Nutrient Balance
          </h3>
          <div id="nutrientChartContainer" class="h-40">
            <canvas id="nutrientChart"></canvas>
          </div>
          <p class="mt-2 text-sm">Predicted Health Index: <span id="predictedHealth">N/A</span>%</p>
        </div>
      </div>
    </section>
  </main>

  <div id="notification" class="fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-xl hidden">
    <i class="fas fa-check-circle mr-2"></i>
    <span>Analysis completed successfully!</span>
  </div>

  <div id="status" class="fixed bottom-4 left-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-xl hidden"></div>

  <script>
    // Initialize charts
    const waterCtx = document.getElementById('waterChart').getContext('2d');
    const nutrientCtx = document.getElementById('nutrientChart').getContext('2d');
    
    const waterChart = new Chart(waterCtx, {
      type: 'bar',
      data: { labels: [], datasets: [] },
      options: { responsive: true, maintainAspectRatio: false }
    });
    
    const nutrientChart = new Chart(nutrientCtx, {
      type: 'doughnut',
      data: { labels: [], datasets: [] },
      options: { responsive: true, maintainAspectRatio: false }
    });

    // Update date time
    function updateDateTime() {
      const now = new Date('2025-07-16T07:15:00+05:30'); // Set to 07:15 AM IST, July 16, 2025
      const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        timeZone: 'Asia/Kolkata',
        hour12: true
      };
      document.getElementById('currentDateTime').textContent = now.toLocaleString('en-US', options);
    }
    
    setInterval(updateDateTime, 60000); // Update every minute
    updateDateTime();
    
    // Simulate connection status
    setTimeout(() => {
      document.getElementById('connectionStatus').innerHTML = 
        '<i class="fas fa-wifi mr-1"></i> Connected';
      document.getElementById('connectionStatus').className = 
        'text-sm bg-green-600 px-3 py-1 rounded flex items-center';
    }, 2000);
    
    // Moisture slider
    document.getElementById('inputMoisture').addEventListener('input', function() {
      document.getElementById('moistureValue').textContent = this.value + '%';
    });
    
    // Water quality database
    const waterDB = {
      canal: { salinity: 0.8, pH: 7.2, arsenic: 0.01, cost: 2.5 },
      well: { salinity: 1.5, pH: 7.8, arsenic: 0.05, cost: 4.0 },
      rainfed: { salinity: 0.2, pH: 6.5, arsenic: 0.001, cost: 0.0 },
      tank: { salinity: 1.0, pH: 7.5, arsenic: 0.03, cost: 3.0 },
      river: { salinity: 0.5, pH: 7.0, arsenic: 0.02, cost: 1.5 }
    };
    
    // Nutrient recommendations
    const nutrientRecs = {
      N: { low: 35, high: 60, unit: 'kg/ha', source: 'Urea', rate: 25 },
      P: { low: 20, high: 40, unit: 'kg/ha', source: 'DAP', rate: 50 },
      K: { low: 100, high: 200, unit: 'kg/ha', source: 'MOP', rate: 30 },
      Zn: { low: 1.5, high: 3.0, unit: 'kg/ha', source: 'ZnSOâ‚„', rate: 5 }
    };
    
    // Mock API response function
    function mockPrediction(N, P, K, Zn, moisture, area) {
      // Simulate prediction based on input data
      const predictedWater = (area * 1000) + Math.floor(Math.random() * 500); // Base water need + random variation
      const predictedHealth = Math.min(50 + (moisture * 0.5) + (N >= 35 ? 20 : 0) + (P >= 20 ? 15 : 0) + (K >= 100 ? 10 : 0) + (Zn >= 1.5 ? 5 : 0) + Math.floor(Math.random() * 10), 100); // Health index calculation
      return { predictedWater, predictedHealth };
    }

    // Fetch prediction function
    async function fetchPrediction(N, P, K, Zn, moisture, area) {
      const status = document.getElementById('status');
      try {
        if (isNaN(N) || isNaN(P) || isNaN(K) || isNaN(Zn) || isNaN(moisture) || isNaN(area)) {
          status.textContent = 'Error: Invalid input data.';
          status.className = 'fixed bottom-4 left-4 bg-red-600 text-white px-4 py-2 rounded-lg shadow-xl';
          return;
        }

        // Simulate API call with mock data
        const data = mockPrediction(N, P, K, Zn, moisture, area);
        document.getElementById('predictedWater').textContent = data.predictedWater || 'N/A';
        document.getElementById('predictedHealth').textContent = data.predictedHealth || 'N/A';
        status.textContent = 'Prediction updated successfully!';
        status.className = 'fixed bottom-4 left-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-xl';
      } catch (error) {
        console.error('Error fetching prediction:', error);
        status.textContent = 'Error fetching prediction. Check console for details.';
        status.className = 'fixed bottom-4 left-4 bg-red-600 text-white px-4 py-2 rounded-lg shadow-xl';
      }
      setTimeout(() => status.className += ' hidden', 3000); // Hide after 3 seconds
    }

    // Form submission
    document.getElementById('irrigationForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Show loading state
      const resultOutput = document.getElementById('resultOutput');
      resultOutput.innerHTML = `
        <div class="text-center py-10">
          <i class="fas fa-cog fa-spin fa-3x text-green-500 mb-3"></i>
          <p class="text-gray-600">Analyzing soil and water data with AI...</p>
        </div>
      `;
      
      // Simulate AI processing delay
      setTimeout(() => {
        analyzeData();
      }, 1500);
    });
    
    function analyzeData() {
      // Get input values
      const N = parseInt(document.getElementById('inputN').value);
      const P = parseInt(document.getElementById('inputP').value);
      const K = parseInt(document.getElementById('inputK').value);
      const Zn = parseFloat(document.getElementById('inputZn').value);
      const moisture = parseInt(document.getElementById('inputMoisture').value);
      const water = document.getElementById('inputWater').value;
      const area = parseFloat(document.getElementById('inputArea').value);
      
      const waterData = waterDB[water];
      
      // Fetch prediction
      fetchPrediction(N, P, K, Zn, moisture, area);
      
      // Analysis logic
      let issues = [];
      let recommendations = [];
      let warnings = [];
      let soilHealthy = true;
      
      // Nutrient analysis
      if (N < nutrientRecs.N.low) { 
        const deficit = nutrientRecs.N.low - N;
        const amount = Math.ceil(deficit * area * 0.1);
        issues.push({
          type: 'danger',
          icon: 'exclamation-triangle',
          message: `Nitrogen deficiency (${N} ppm)`,
          action: `Apply ${amount} kg ${nutrientRecs.N.source} (${nutrientRecs.N.rate} kg/ha)`
        });
        soilHealthy = false;
      } else if (N > nutrientRecs.N.high) {
        warnings.push({
          type: 'warning',
          icon: 'exclamation-circle',
          message: `High nitrogen levels (${N} ppm)`,
          action: `Reduce nitrogen application to prevent lodging`
        });
      }
      
      if (P < nutrientRecs.P.low) {
        const deficit = nutrientRecs.P.low - P;
        const amount = Math.ceil(deficit * area * 0.15);
        issues.push({
          type: 'danger',
          icon: 'exclamation-triangle',
          message: `Phosphorus deficiency (${P} ppm)`,
          action: `Apply ${amount} kg ${nutrientRecs.P.source} (${nutrientRecs.P.rate} kg/ha)`
        });
        soilHealthy = false;
      }
      
      if (K < nutrientRecs.K.low) {
        const deficit = nutrientRecs.K.low - K;
        const amount = Math.ceil(deficit * area * 0.08);
        issues.push({
          type: 'warning',
          icon: 'exclamation-triangle',
          message: `Potassium deficiency (${K} ppm)`,
          action: `Apply ${amount} kg ${nutrientRecs.K.source} (${nutrientRecs.K.rate} kg/ha)`
        });
        soilHealthy = false;
      }
      
      if (Zn < nutrientRecs.Zn.low) {
        const deficit = nutrientRecs.Zn.low - Zn;
        const amount = Math.ceil(deficit * area * 2);
        issues.push({
          type: 'danger',
          icon: 'exclamation-triangle',
          message: `Zinc deficiency (${Zn} ppm)`,
          action: `Apply ${amount} kg ${nutrientRecs.Zn.source} or foliar spray`
        });
        soilHealthy = false;
      }
      
      // Moisture analysis
      let moistureStatus = '';
      if (moisture < 40) {
        moistureStatus = 'Critical (needs immediate irrigation)';
        issues.push({
          type: 'danger',
          icon: 'tint-slash',
          message: 'Extremely low soil moisture',
          action: 'Irrigate immediately with 5-7 cm standing water'
        });
      } else if (moisture < 60) {
        moistureStatus = 'Low (irrigation recommended)';
        issues.push({
          type: 'warning',
          icon: 'tint',
          message: 'Low soil moisture',
          action: 'Irrigate with 3-5 cm standing water'
        });
      } else if (moisture < 80) {
        moistureStatus = 'Optimal';
      } else {
        moistureStatus = 'High (reduce irrigation)';
        warnings.push({
          type: 'warning',
          icon: 'water',
          message: 'Excessive soil moisture',
          action: 'Reduce irrigation to prevent waterlogging'
        });
      }
      
      // Water quality analysis
      let waterQuality = 'Good';
      let waterIssues = [];
      
      if (waterData.salinity > 1.5) {
        waterQuality = 'Poor';
        waterIssues.push(`High salinity (${waterData.salinity} dS/m)`);
      }
      if (waterData.arsenic > 0.04) {
        waterQuality = 'Poor';
        waterIssues.push(`High arsenic (${waterData.arsenic} ppm)`);
      }
      if (waterData.pH < 6.5 || waterData.pH > 8.5) {
        waterQuality = 'Marginal';
        waterIssues.push(`Suboptimal pH (${waterData.pH})`);
      }
      
      // Irrigation decision
      const irrigationOK = soilHealthy && waterQuality !== 'Poor' && moisture < 80;
      
      // Yield prediction (simplified)
      let yieldImpact = 0;
      if (!soilHealthy) yieldImpact -= 15;
      if (waterQuality === 'Poor') yieldImpact -= 20;
      else if (waterQuality === 'Marginal') yieldImpact -= 5;
      if (moisture < 40) yieldImpact -= 25;
      else if (moisture < 60) yieldImpact -= 10;
      else if (moisture > 80) yieldImpact -= 5;
      
      // Generate results
      const results = [];
      
      // Summary card
      results.push(`
        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
          <div class="flex justify-between items-start">
            <div>
              <h3 class="font-medium text-green-800">Irrigation Summary</h3>
              <p class="text-sm text-gray-600">${new Date().toLocaleString()}</p>
            </div>
            <span class="px-2 py-1 rounded-full text-xs font-medium 
              ${irrigationOK ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
              ${irrigationOK ? 'Recommended' : 'Not Recommended'}
            </span>
          </div>
          <div class="mt-3 grid grid-cols-3 gap-2 text-center">
            <div class="bg-white p-2 rounded">
              <div class="text-xs text-gray-500">Soil Health</div>
              <div class="font-medium ${soilHealthy ? 'text-green-600' : 'text-red-600'}">
                ${soilHealthy ? 'Good' : 'Needs Attention'}
              </div>
            </div>
            <div class="bg-white p-2 rounded">
              <div class="text-xs text-gray-500">Water Quality</div>
              <div class="font-medium ${
                waterQuality === 'Good' ? 'text-green-600' : 
                waterQuality === 'Marginal' ? 'text-yellow-600' : 'text-red-600'
              }">${waterQuality}</div>
            </div>
            <div class="bg-white p-2 rounded">
              <div class="text-xs text-gray-500">Moisture</div>
              <div class="font-medium">${moisture}%</div>
            </div>
          </div>
        </div>
      `);
      
      // Detailed recommendations
      if (irrigationOK) {
        recommendations.push({
          type: 'success',
          icon: 'check-circle',
          message: 'Optimal irrigation conditions',
          action: 'Proceed with irrigation using Alternate Wetting and Drying (AWD) method'
        });
        
        recommendations.push({
          type: 'info',
          icon: 'chart-line',
          message: 'Yield prediction',
          action: `Expected yield impact: ${yieldImpact >= 0 ? '+' : ''}${yieldImpact}% from baseline`
        });
      } else {
        recommendations.push({
          type: 'danger',
          icon: 'times-circle',
          message: 'Irrigation not recommended',
          action: 'Address the issues below before irrigating'
        });
      }
      
      // Water details
      recommendations.push({
        type: 'info',
        icon: 'tint',
        message: `Water source: ${water}`,
        action: `Salinity: ${waterData.salinity} dS/m | pH: ${waterData.pH} | Arsenic: ${waterData.arsenic} ppm | Cost: $${waterData.cost}/acre`
      });
      
      // Moisture details
      recommendations.push({
        type: 'info',
        icon: 'water',
        message: 'Soil moisture status',
        action: moistureStatus
      });
      
      // Add all to results
      results.push(`
        <div class="space-y-3">
          <h4 class="font-medium text-gray-700 flex items-center">
            <i class="fas fa-clipboard-list mr-2 text-blue-500"></i> Recommendations
          </h4>
          ${[...recommendations, ...warnings, ...issues].map(item => `
            <div class="flex items-start p-3 rounded-lg ${
              item.type === 'danger' ? 'bg-red-50 border border-red-100' :
              item.type === 'warning' ? 'bg-yellow-50 border border-yellow-100' :
              item.type === 'success' ? 'bg-green-50 border border-green-100' :
              'bg-blue-50 border border-blue-100'
            }">
              <i class="fas fa-${item.icon} mt-1 mr-3 ${
                item.type === 'danger' ? 'text-red-500' :
                item.type === 'warning' ? 'text-yellow-500' :
                item.type === 'success' ? 'text-green-500' :
                'text-blue-500'
              }"></i>
              <div>
                <div class="font-medium">${item.message}</div>
                <div class="text-sm text-gray-600 mt-1">${item.action}</div>
              </div>
            </div>
          `).join('')}
        </div>
      `);
      
      // Update charts
      updateCharts(N, P, K, Zn, moisture, waterData);
      
      // Display results
      document.getElementById('resultOutput').innerHTML = results.join('');
      
      // Show notification
      const notification = document.getElementById('notification');
      notification.classList.remove('hidden');
      setTimeout(() => notification.classList.add('hidden'), 3000);
    }
    
    function updateCharts(N, P, K, Zn, moisture, waterData) {
      // Water chart
      waterChart.data = {
        labels: ['Salinity', 'pH', 'Arsenic'],
        datasets: [{
          label: 'Water Quality',
          data: [waterData.salinity, waterData.pH, waterData.arsenic * 100],
          backgroundColor: [
            'rgba(54, 162, 235, 0.7)',
            'rgba(75, 192, 192, 0.7)',
            'rgba(255, 99, 132, 0.7)'
          ],
          borderColor: [
            'rgba(54, 162, 235, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(255, 99, 132, 1)'
          ],
          borderWidth: 1
        }]
      };
      
      waterChart.options.scales = {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Value'
          }
        }
      };
      
      // Nutrient chart
      nutrientChart.data = {
        labels: ['Nitrogen', 'Phosphorus', 'Potassium', 'Zinc'],
        datasets: [{
          data: [N, P, K, Zn * 20],
          backgroundColor: [
            'rgba(255, 99, 132, 0.7)',
            'rgba(54, 162, 235, 0.7)',
            'rgba(255, 206, 86, 0.7)',
            'rgba(75, 192, 192, 0.7)'
          ],
          borderColor: [
            'rgba(255, 99, 132, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)'
          ],
          borderWidth: 1
        }]
      };
      
      waterChart.update();
      nutrientChart.update();
    }
    
    // Button handlers
    document.getElementById('saveBtn').addEventListener('click', function() {
      alert('Analysis saved to your history!');
    });
    
    document.getElementById('historyBtn').addEventListener('click', function() {
      alert('Viewing historical data...');
    });
  </script>
</body>
</html>